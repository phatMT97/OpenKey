<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenKey Settings</title>
    <link rel="stylesheet" href="settings.css">
    <script type="module" src="settings.js"></script>
</head>

<body>
    <!-- Hidden checkbox for expand/collapse state - CSS uses :checked selector -->
    <input type="checkbox" id="expand-checkbox" style="display:none;">

    <div class="container" id="main-container">
        <!-- Title Bar - spans full width, close button at right corner -->
        <div class="title-bar">
            <span class="title-text">NeXTKey</span>
            <button class="btn-close" id="btn-close" title="Đóng">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"
                    fill="rgba(240,23,23,1)">
                    <path
                        d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 10.5858L9.17157 7.75736L7.75736 9.17157L10.5858 12L7.75736 14.8284L9.17157 16.2426L12 13.4142L14.8284 16.2426L16.2426 14.8284L13.4142 12L16.2426 9.17157L14.8284 7.75736L12 10.5858Z">
                    </path>
                </svg>
            </button>
        </div>

        <!-- Compact Section (Left Panel) -->
        <div class="compact-section">
            <!-- Header: V - toggle - E - dropdown -->
            <div class="header">
                <!-- V/E toggle pill with labels inside -->
                <div class="toggle-switch" id="toggle-language">
                    <span class="toggle-label toggle-v">V</span>
                    <span class="toggle-label toggle-e">E</span>
                    <div class="toggle-thumb"></div>
                </div>
                <!-- Hidden input to fire VALUE_CHANGED -->
                <input type="hidden" id="val-toggle-language" value="0">

                <select class="input-type-dropdown" id="input-type">
                    <option value="0">Telex</option>
                    <option value="1">VNI</option>
                    <option value="2">Simple Telex 1</option>
                    <option value="3">Simple Telex 2</option>
                </select>
            </div>

            <!-- Settings Card -->
            <div class="settings-card">
                <!-- 1. Bảng mã (Code Table) -->
                <div class="setting-row">
                    <span class="setting-label">Bảng mã</span>
                    <select class="setting-dropdown" id="bang-ma">
                        <option value="0">Unicode</option>
                        <option value="1">TCVN3 (ABC)</option>
                        <option value="2">VNI Windows</option>
                        <option value="3">Unicode Compound</option>
                        <option value="4">Vietnamese Locale</option>
                    </select>
                </div>

                <!-- 2. Phím Chuyển (Switch Key) - 2 rows layout -->
                <div class="setting-row setting-row-vertical">
                    <span class="setting-label">Phím Chuyển</span>
                    <div class="switch-key-container">
                        <!-- Row 1: Ctrl Alt -->
                        <div class="switch-key-row">
                            <div class="switch-key-item">
                                <span class="switch-key-label">Ctrl</span>
                                <div class="toggle-switch-small" id="key-ctrl">
                                    <span class="toggle-label-i">I</span>
                                    <span class="toggle-label-o">O</span>
                                    <div class="toggle-thumb-small"></div>
                                </div>
                                <input type="hidden" id="val-key-ctrl" value="0">
                            </div>
                            <div class="switch-key-item">
                                <span class="switch-key-label">Alt</span>
                                <div class="toggle-switch-small" id="key-alt">
                                    <span class="toggle-label-i">I</span>
                                    <span class="toggle-label-o">O</span>
                                    <div class="toggle-thumb-small"></div>
                                </div>
                                <input type="hidden" id="val-key-alt" value="0">
                            </div>
                        </div>
                        <!-- Row 2: Win Shift + textbox -->
                        <div class="switch-key-row">
                            <div class="switch-key-item">
                                <span class="switch-key-label">Win</span>
                                <div class="toggle-switch-small" id="key-win">
                                    <span class="toggle-label-i">I</span>
                                    <span class="toggle-label-o">O</span>
                                    <div class="toggle-thumb-small"></div>
                                </div>
                                <input type="hidden" id="val-key-win" value="0">
                            </div>
                            <div class="switch-key-item">
                                <span class="switch-key-label">Shift</span>
                                <div class="toggle-switch-small" id="key-shift">
                                    <span class="toggle-label-i">I</span>
                                    <span class="toggle-label-o">O</span>
                                    <div class="toggle-thumb-small"></div>
                                </div>
                                <input type="hidden" id="val-key-shift" value="0">
                            </div>
                            <input type="text" class="switch-key-input" id="switch-key-char" maxlength="1"
                                placeholder="~" title="Phím chuyển">
                        </div>
                    </div>
                </div>

                <!-- 3. Kêu Beep -->
                <div class="setting-row">
                    <span class="setting-label">Kêu Beep</span>
                    <div class="toggle-switch-small" id="beep-sound"
                        data-tooltip="Phát âm thanh khi chuyển đổi ngôn ngữ">
                        <span class="toggle-label-i">I</span>
                        <span class="toggle-label-o">O</span>
                        <div class="toggle-thumb-small"></div>
                    </div>
                    <input type="hidden" id="val-beep-sound" value="0">
                </div>

                <!-- 4. Loại trừ ứng dụng thông minh -->
                <div class="setting-row">
                    <span class="setting-label">Loại trừ ứng dụng thông minh</span>
                    <div class="toggle-switch-small" id="smart-switch"
                        data-tooltip="Tự động ghi nhớ chế độ gõ cho từng ứng dụng">
                        <span class="toggle-label-i">I</span>
                        <span class="toggle-label-o">O</span>
                        <div class="toggle-thumb-small"></div>
                    </div>
                    <input type="hidden" id="val-smart-switch" value="0">
                </div>

                <!-- 4b. Excluded Apps - Toggle + Button on same row -->
                <div class="setting-row">
                    <span class="setting-label">Bật loại trừ ứng dụng</span>
                    <button class="btn-action" id="btn-excluded-apps" style="margin-right: 8px;">Danh sách</button>
                    <div class="toggle-switch-small" id="exclude-apps"
                        data-tooltip="Chỉ gõ tiếng Anh cho các ứng dụng trong danh sách">
                        <span class="toggle-label-i">I</span>
                        <span class="toggle-label-o">O</span>
                        <div class="toggle-thumb-small"></div>
                    </div>
                    <input type="hidden" id="val-exclude-apps" value="0">
                </div>

                <!-- 5. Cài đặt nâng cao - clickable row -->
                <div class="setting-row setting-row-clickable" id="btn-advanced">
                    <span class="setting-label">Cài đặt nâng cao</span>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="arrow-icon"
                        class="arrow-icon">
                        <path d="M9 18l6-6-6-6"></path>
                    </svg>
                </div>
                <!-- Hidden input for expand state (for C++ VALUE_CHANGED handler) -->
                <input type="hidden" id="val-expand-state" value="0">
            </div>
        </div>

        <!-- Advanced Section (Right Panel - hidden by default) -->
        <div class="advanced-section" id="advanced-section">
            <!-- Tab Header (horizontal tabs at top) -->
            <div class="tab-header">
                <div class="tab-item active" data-tab="1">Bộ gõ</div>
                <div class="tab-item" data-tab="2">Gõ tắt</div>
                <div class="tab-item" data-tab="3">Hệ thống</div>
                <div class="tab-item" data-tab="4">Thông tin</div>
            </div>

            <!-- Tab Content Area (below tabs) -->
            <div class="tab-content" id="tab-content">
                <!-- Tab 1: Bộ gõ (Input Method) - Default active -->
                <div class="tab-panel active" id="tab-panel-1">
                    <div class="tab-body">
                        <!-- 1. Modern diacritics (oà, uý) -->
                        <div class="setting-row">
                            <span class="setting-label">Đặt dấu oà, uý (thay vì òa, úy)</span>
                            <div class="toggle-switch-small" id="modern-ortho">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-modern-ortho" value="0">
                        </div>
                        <!-- 2. Browser/Excel fix -->
                        <div class="setting-row">
                            <span class="setting-label">Sửa lỗi gợi ý (trình duyệt, Excel)</span>
                            <div class="toggle-switch-small" id="fix-recommend">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-fix-recommend" value="0">
                        </div>
                        <!-- 3. Auto capitalize -->
                        <div class="setting-row">
                            <span class="setting-label">Viết hoa chữ cái đầu câu</span>
                            <div class="toggle-switch-small" id="auto-caps">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-auto-caps" value="0">
                        </div>
                        <!-- 4. Remember code table per app -->
                        <div class="setting-row">
                            <span class="setting-label">Tự ghi nhớ bảng mã theo ứng dụng</span>
                            <div class="toggle-switch-small" id="remember-code">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-remember-code" value="0">
                        </div>
                        <!-- 5. Spell check -->
                        <div class="setting-row">
                            <span class="setting-label">Kiểm tra chính tả</span>
                            <div class="toggle-switch-small" id="spell-check">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-spell-check" value="0">
                        </div>
                        <!-- 6. Restore key on wrong word -->
                        <div class="setting-row">
                            <span class="setting-label">Tự khôi phục phím với từ sai</span>
                            <div class="toggle-switch-small" id="restore-key">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-restore-key" value="0">
                        </div>
                        <!-- 7. Allow ZWJF consonants -->
                        <div class="setting-row">
                            <span class="setting-label">Cho phép "z w j f" làm phụ âm đầu</span>
                            <div class="toggle-switch-small" id="allow-zwjf">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-allow-zwjf" value="0">
                        </div>
                        <!-- 8. Temp disable spell with Ctrl -->
                        <div class="setting-row">
                            <span class="setting-label">Tạm tắt chính tả bằng phím Ctrl</span>
                            <div class="toggle-switch-small" id="temp-off-spell"
                                data-tooltip="Giữ Ctrl khi gõ để tạm bỏ qua kiểm tra chính tả">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-temp-off-spell" value="0">
                        </div>
                        <!-- 9. Temp disable OpenKey with Alt -->
                        <div class="setting-row">
                            <span class="setting-label">Tạm tắt OpenKey bằng phím Alt</span>
                            <div class="toggle-switch-small" id="temp-off-openkey"
                                data-tooltip="Giữ Alt khi gõ để tạm tắt bộ gõ tiếng Việt">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-temp-off-openkey" value="0">
                        </div>
                    </div>
                </div>

                <!-- Tab 2: Gõ tắt (Shortcuts/Macro) -->
                <div class="tab-panel" id="tab-panel-2">
                    <div class="tab-body">
                        <!-- 1. Enable Macro -->
                        <div class="setting-row">
                            <span class="setting-label">Cho phép gõ tắt</span>
                            <div class="toggle-switch-small" id="use-macro">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-use-macro" value="0">
                        </div>
                        <!-- 2. Macro in English mode -->
                        <div class="setting-row">
                            <span class="setting-label">Gõ tắt cả khi tắt gõ tiếng Việt</span>
                            <div class="toggle-switch-small" id="macro-english">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-macro-english" value="0">
                        </div>
                        <!-- 3. Auto caps macro -->
                        <div class="setting-row">
                            <span class="setting-label">Tự động viết hoa theo phím tắt</span>
                            <div class="toggle-switch-small" id="auto-caps-macro">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-auto-caps-macro" value="0">
                        </div>
                        <!-- 4. Quick Telex -->
                        <div class="setting-row">
                            <span class="setting-label"
                                title="cc=ch, gg=gi, kk=kh, nn=ng, qq=qu, pp=ph, tt=th, uu=ươ">Gõ nhanh (cc=ch, gg=gi,
                                nn=ng,...)</span>
                            <div class="toggle-switch-small" id="quick-telex">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-quick-telex" value="0">
                        </div>
                        <!-- 5. Quick start consonant -->
                        <div class="setting-row">
                            <span class="setting-label" title="f→ph, j→gi, w→qu">Gõ tắt phụ âm đầu: f→ph, j→gi,
                                w→qu</span>
                            <div class="toggle-switch-small" id="quick-start">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-quick-start" value="0">
                        </div>
                        <!-- 6. Quick end consonant -->
                        <div class="setting-row">
                            <span class="setting-label" title="g→ng, h→nh, k→ch">Gõ tắt phụ âm cuối: g→ng, h→nh,
                                k→ch</span>
                            <div class="toggle-switch-small" id="quick-end">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-quick-end" value="0">
                        </div>
                        <!-- Button to open Macro Table dialog -->
                        <div class="setting-row" style="justify-content: flex-start; padding-top: 8px;">
                            <button class="btn-action" id="btn-macro-table">Bảng gõ tắt...</button>
                        </div>
                    </div>
                </div>

                <!-- Tab 3: Hệ thống (System) -->
                <div class="tab-panel" id="tab-panel-3">
                    <div class="tab-body">
                        <!-- 1. Hỗ trợ ứng dụng Metro -->
                        <div class="setting-row">
                            <span class="setting-label">Hỗ trợ ứng dụng Metro</span>
                            <div class="toggle-switch-small" id="metro-support"
                                data-tooltip="Hỗ trợ gõ tiếng Việt trong ứng dụng UWP/Metro">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-metro-support" value="0">
                        </div>
                        <!-- 2. Tạo biểu tượng trên Desktop -->
                        <div class="setting-row">
                            <span class="setting-label">Tạo biểu tượng trên Desktop</span>
                            <div class="toggle-switch-small" id="desktop-shortcut">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-desktop-shortcut" value="0">
                        </div>
                        <!-- 3. Khởi động cùng Windows -->
                        <div class="setting-row">
                            <span class="setting-label">Khởi động cùng Windows</span>
                            <div class="toggle-switch-small" id="run-startup">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-run-startup" value="0">
                        </div>
                        <!-- 4. Bật bảng này khi khởi động -->
                        <div class="setting-row">
                            <span class="setting-label">Bật bảng này khi khởi động</span>
                            <div class="toggle-switch-small" id="show-on-startup">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-show-on-startup" value="0">
                        </div>
                        <!-- 5. Biểu tượng hiện đại -->
                        <div class="setting-row">
                            <span class="setting-label">Biểu tượng hiện đại</span>
                            <div class="toggle-switch-small" id="modern-icon">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-modern-icon" value="0">
                        </div>
                        <!-- 6. Sửa lỗi trên Chromium -->
                        <div class="setting-row">
                            <span class="setting-label">Sửa lỗi trên Chromium</span>
                            <div class="toggle-switch-small" id="chromium-fix"
                                data-tooltip="Khắc phục lỗi gõ trên Chrome, Edge, các trình duyệt Chromium">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-chromium-fix" value="0">
                        </div>
                        <!-- 7. Chạy với quyền Admin -->
                        <div class="setting-row">
                            <span class="setting-label">Chạy với quyền Admin</span>
                            <div class="toggle-switch-small" id="run-admin">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-run-admin" value="0">
                        </div>
                        <!-- 8. Dùng clipboard để gửi phím -->
                        <div class="setting-row">
                            <span class="setting-label">Dùng clipboard để gửi phím</span>
                            <div class="toggle-switch-small" id="use-clipboard"
                                data-tooltip="Dùng clipboard thay vì SendInput để gửi ký tự (tương thích tốt hơn)">
                                <span class="toggle-label-i">I</span>
                                <span class="toggle-label-o">O</span>
                                <div class="toggle-thumb-small"></div>
                            </div>
                            <input type="hidden" id="val-use-clipboard" value="0">
                        </div>
                    </div>
                </div>

                <!-- Tab 4: Thông tin (About) -->
                <div class="tab-panel" id="tab-panel-4">
                    <div class="tab-body about-content">
                        <p class="app-name">NextKey</p>
                        <p class="app-tagline">Bộ gõ Tiếng Việt giao diện hiện đại</p>
                        <p class="app-version">Phiên bản: 1.0.0 (Sciter Edition)</p>
                        <p class="app-author">Phát triển & Thiết kế UI: <strong>PhatMT97</strong></p>
                        <p class="app-origin">Nguồn gốc: Dự án được fork và cải tiến giao diện dựa trên mã nguồn OpenKey
                            của tác giả <strong>Mai Vũ Tuyên</strong>.</p>
                        <p class="app-license">NextKey là phần mềm mã nguồn mở, miễn phí và phi lợi nhuận.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>